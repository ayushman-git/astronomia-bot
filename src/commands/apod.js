const { MessageEmbed } = require("discord.js");
require("dotenv").config();
const axios = require("axios");

let apodData = null;
const apodEmbed = new MessageEmbed();
function fetchData() {
  axios
    .get(
      "https://api.nasa.gov/planetary/apod?api_key=" + process.env.NASA_APID_KEY
    )
    .then((res) => {
      apodData = res.data;
      apodEmbed
        .setColor("#F0386B")
        .setTitle(apodData.title)
        .setURL(apodData.url)
        .setImage(apodData.url)
        .setDescription(apodData.explanation)
        .setTimestamp()
        .setFooter(
          "Generated by astronomia with NASA's APOD API",
          "https://www.nasa.gov/sites/default/files/thumbnails/image/nasa-logo-web-rgb.png"
        );
      console.log("APOD Image fetched", Date());
    })
    .catch((err) => {
      console.log(err);
    });
}
fetchData();
setInterval(() => {
  fetchData();
}, 3600000);

module.exports = {
  name: "apod",
  aliases: ["a"],
  description: "Astronomy Picture of Day",
  execute(message, args) {
    (async () => {
      message.channel.send(apodEmbed).then(async (msg) => {
        await msg.react("‚ù§");
      });
    })();
  },
};
